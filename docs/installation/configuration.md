# Configuration Reference

This guide provides a comprehensive reference for all configuration options in the MCP OAuth Gateway.

## Environment Variables

### Core Configuration

```bash
# Base domain for all services (REQUIRED)
BASE_DOMAIN=gateway.example.com

# ACME email for Let's Encrypt certificates (REQUIRED)
ACME_EMAIL=admin@example.com
```

### OAuth Configuration

```bash
# GitHub OAuth Application (REQUIRED)
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret

# JWT Configuration (REQUIRED)
GATEWAY_JWT_SECRET=your-generated-jwt-secret-at-least-32-chars
JWT_ALGORITHM=RS256  # or HS256
JWT_PRIVATE_KEY_B64=your-base64-encoded-private-key  # For RS256 only

# OAuth Tokens (auto-generated by 'just generate-github-token')
GATEWAY_OAUTH_ACCESS_TOKEN=
GATEWAY_OAUTH_REFRESH_TOKEN=
GATEWAY_OAUTH_CLIENT_ID=
GATEWAY_OAUTH_CLIENT_SECRET=

# GitHub PAT (generated during setup)
GITHUB_PAT=ghp_xxxxxxxxxxxxxxxxxxxx

# Client Configuration
CLIENT_LIFETIME=7776000  # 90 days in seconds (0 for eternal)
```

### Security Configuration

```bash
# Allowed GitHub Users (REQUIRED)
ALLOWED_GITHUB_USERS=user1,user2  # Comma-separated list
# Or use '*' to allow any authenticated GitHub user

# CORS Settings
MCP_CORS_ORIGINS=*  # Or specific origins like https://claude.ai

# Redis Password (REQUIRED)
REDIS_PASSWORD=your-secure-redis-password
REDIS_URL=redis://redis:6379
```

### Token Lifetimes

```bash
# Token Lifetimes in seconds (REQUIRED)
ACCESS_TOKEN_LIFETIME=86400      # 24 hours
REFRESH_TOKEN_LIFETIME=2592000   # 30 days  
SESSION_TIMEOUT=3600             # 1 hour
```

### MCP Configuration

```bash
# MCP Protocol Version (REQUIRED)
MCP_PROTOCOL_VERSION=2025-06-18

# Supported Protocol Versions
MCP_PROTOCOL_VERSIONS_SUPPORTED=2025-06-18,2025-03-26,2024-11-05

# MCP Client Tokens (generated by 'just mcp-client-token')
MCP_CLIENT_ACCESS_TOKEN=
MCP_CLIENT_REFRESH_TOKEN=
MCP_CLIENT_ID=
MCP_CLIENT_SECRET=

# MCP Testing URL (optional - for specific MCP service testing)
MCP_TESTING_URL=https://fetch.yourdomain.com/mcp
```

### Test Configuration

```bash
# Test Configuration (for running tests)
TEST_HTTP_TIMEOUT=30.0
TEST_MAX_RETRIES=30
TEST_RETRY_DELAY=2.0
TEST_CALLBACK_URL=https://auth.yourdomain.com/success
TEST_CLIENT_NAME="TEST default_client"
TEST_CLIENT_SCOPE="openid profile email"
TEST_REDIRECT_URI=https://auth.yourdomain.com/success
TEST_INVALID_REDIRECT_URI=http://evil.com/callback

# Health Check Configuration
HEALTH_CHECK_TIMEOUT=60
HEALTH_CHECK_INTERVAL=2
```

## Configuration Files

### .env File Structure

Create a `.env` file in the project root:

```bash
# Copy from .env.example
cp .env.example .env

# Edit with your values
vim .env
```

### Docker Compose Override

For environment-specific settings, create `docker-compose.override.yml`:

```yaml
services:
  auth:
    environment:
      - DEBUG=true
      - LOG_LEVEL=DEBUG
  
  mcp-fetch:
    volumes:
      - ./custom-config:/config
```

## Service Configuration

All services are configured through the main `.env` file in the project root. Services automatically inherit these environment variables through Docker Compose.

### MCP Service Enable/Disable Configuration

Each MCP service can be individually enabled/disabled:

```bash
# MCP Everything service
MCP_EVERYTHING_ENABLED=true              # Enable/disable mcp-everything service
MCP_EVERYTHING_TESTS_ENABLED=false       # Enable/disable mcp-everything tests
MCP_EVERYTHING_URLS=https://everything.yourdomain.com/mcp

# MCP Fetch service
MCP_FETCH_ENABLED=true                   # Enable/disable mcp-fetch service
MCP_FETCH_TESTS_ENABLED=false            # Enable/disable mcp-fetch tests
MCP_FETCH_URLS=https://fetch.yourdomain.com/mcp

# MCP Fetchs service
MCP_FETCHS_ENABLED=true                  # Enable/disable mcp-fetchs service
MCP_FETCHS_TESTS_ENABLED=false           # Enable/disable mcp-fetchs tests
MCP_FETCHS_URLS=https://fetchs.yourdomain.com/mcp

# MCP Filesystem service
MCP_FILESYSTEM_ENABLED=true              # Enable/disable mcp-filesystem service
MCP_FILESYSTEM_TESTS_ENABLED=false       # Enable/disable mcp-filesystem tests
MCP_FILESYSTEM_URLS=https://filesystem.yourdomain.com/mcp

# MCP Memory service
MCP_MEMORY_ENABLED=true                  # Enable/disable mcp-memory service
MCP_MEMORY_TESTS_ENABLED=false           # Enable/disable mcp-memory tests
MCP_MEMORY_URLS=https://memory.yourdomain.com/mcp

# MCP Playwright service
MCP_PLAYWRIGHT_ENABLED=true              # Enable/disable mcp-playwright service
MCP_PLAYWRIGHT_TESTS_ENABLED=false       # Enable/disable mcp-playwright tests
MCP_PLAYWRIGHT_URLS=https://playwright.yourdomain.com/mcp

# MCP Sequential Thinking service
MCP_SEQUENTIALTHINKING_ENABLED=true      # Enable/disable mcp-sequentialthinking service
MCP_SEQUENTIALTHINKING_TESTS_ENABLED=false # Enable/disable mcp-sequentialthinking tests
MCP_SEQUENTIALTHINKING_URLS=https://sequentialthinking.yourdomain.com/mcp

# MCP Time service
MCP_TIME_ENABLED=true                    # Enable/disable mcp-time service
MCP_TIME_TESTS_ENABLED=false             # Enable/disable mcp-time tests
MCP_TIME_URLS=https://time.yourdomain.com/mcp

# MCP Tmux service
MCP_TMUX_ENABLED=true                    # Enable/disable mcp-tmux service
MCP_TMUX_TESTS_ENABLED=false             # Enable/disable mcp-tmux tests
MCP_TMUX_URLS=https://tmux.yourdomain.com/mcp
```

**Note:** 
- When a service is disabled (`*_ENABLED=false`), it won't be included in docker-compose
- Test flags (`*_TESTS_ENABLED`) control whether tests for that service run
- URLs can be comma-separated for multiple instances of the same service

## Advanced Configuration

### Redis Persistence

Redis is configured with persistence by default in the Redis container. The data is stored in the `redis-data` Docker volume.

### Logging

Logs are collected via Docker and stored in the `./logs/` directory.

## Validation

### Configuration Validation

The gateway validates required configuration on startup. Missing required variables will cause services to fail with clear error messages in the logs.

### Required Variables

These variables must be set:

- `BASE_DOMAIN`
- `ACME_EMAIL`
- `GITHUB_CLIENT_ID`
- `GITHUB_CLIENT_SECRET`
- `GATEWAY_JWT_SECRET`
- `REDIS_PASSWORD`
- `ALLOWED_GITHUB_USERS`
- `ACCESS_TOKEN_LIFETIME`
- `REFRESH_TOKEN_LIFETIME`
- `SESSION_TIMEOUT`
- `MCP_PROTOCOL_VERSION`

### Auto-Generated Variables

These are generated automatically:

- `GATEWAY_OAUTH_ACCESS_TOKEN`
- `GATEWAY_OAUTH_REFRESH_TOKEN`
- `GATEWAY_OAUTH_CLIENT_ID`
- `GATEWAY_OAUTH_CLIENT_SECRET`

## Best Practices

1. **Use .env.example** - Keep it updated with all variables
2. **Never commit .env** - Contains secrets
3. **Rotate secrets regularly** - Especially JWT secrets
4. **Use strong passwords** - For Redis and other services
5. **Limit allowed users** - Use GitHub user whitelist
6. **Monitor configuration** - Log config changes

## Troubleshooting

### Common Issues

1. **Missing Variables**
   ```bash
   ERROR: Required variable GITHUB_CLIENT_ID not set
   ```
   Solution: Check .env file exists and is loaded

2. **Invalid JWT Secret**
   ```bash
   ERROR: JWT secret must be at least 32 characters
   ```
   Solution: Use `just generate-jwt-secret`

3. **Redis Connection Failed**
   ```bash
   ERROR: Could not connect to Redis
   ```
   Solution: Ensure Redis service is running


## Next Steps

1. Complete [GitHub OAuth Setup](github-oauth.md)
2. Generate secrets with provided commands
3. Start services with `just up`