# Minimal Setup Guide

This guide shows the **absolute minimum** configuration needed to run the MCP OAuth Gateway.

## Quick Summary

You only need **5 tokens** to run the gateway:

1. GitHub OAuth App credentials (2 tokens)
2. JWT signing keys (2 tokens)
3. Redis password (1 token)

Everything else in `.env.example` is for testing or optional features.

## Step-by-Step Minimal Setup

### 1. Prerequisites

- Docker and Docker Compose installed
- A public domain with DNS configured
- Ports 80 and 443 accessible

### 2. Create GitHub OAuth App

1. Go to [github.com/settings/developers](https://github.com/settings/developers)
2. Click "New OAuth App"
3. Fill in:
   - **Application name**: `MCP OAuth Gateway`
   - **Homepage URL**: `https://yourdomain.com`
   - **Authorization callback URL**: `https://auth.yourdomain.com/callback`
4. Save the Client ID and Client Secret

### 3. Minimal `.env` File

Create a `.env` file with only these required values:

```bash
# Domain (must be real, publicly accessible)
BASE_DOMAIN=yourdomain.com
ACME_EMAIL=admin@yourdomain.com

# GitHub OAuth App (from step 2)
GITHUB_CLIENT_ID=Iv1.a1b2c3d4e5f6g7h8
GITHUB_CLIENT_SECRET=1234567890abcdef1234567890abcdef12345678

# Generate these with just commands
GATEWAY_JWT_SECRET=  # Run: just generate-jwt-secret
JWT_ALGORITHM=RS256
JWT_PRIVATE_KEY_B64=  # Run: just generate-rsa-keys
REDIS_PASSWORD=  # Run: just generate-redis-password

# User access control
ALLOWED_GITHUB_USERS=*  # Or specific users: user1,user2

# Token lifetimes (use defaults)
ACCESS_TOKEN_LIFETIME=86400
REFRESH_TOKEN_LIFETIME=2592000
SESSION_TIMEOUT=3600
CLIENT_LIFETIME=7776000

# Protocol version
MCP_PROTOCOL_VERSION=2025-06-18
MCP_PROTOCOL_VERSIONS_SUPPORTED=2025-06-18,2025-03-26,2024-11-05
MCP_CORS_ORIGINS=*
```

### 4. Generate Required Secrets

```bash
# Generate all secrets at once
just generate-all-secrets

# Or generate individually:
# just generate-jwt-secret      # JWT signing secret
# just generate-rsa-keys        # RSA private key
# just generate-redis-password  # Redis password
```

### 5. Start the Gateway

```bash
# Start all services
just up

# Verify health
just check-health
```

## What About All the Other Tokens?

The `.env.example` file contains many more tokens, but they're **NOT required**:

### Tokens for Testing Only

These are generated by test commands and only used by the test suite:

- `GITHUB_PAT` - GitHub Personal Access Token
- `GATEWAY_OAUTH_ACCESS_TOKEN` - Test OAuth token
- `GATEWAY_OAUTH_REFRESH_TOKEN` - Test refresh token
- `GATEWAY_OAUTH_CLIENT_ID` - Test client ID
- `GATEWAY_OAUTH_CLIENT_SECRET` - Test client secret
- `MCP_CLIENT_ACCESS_TOKEN` - MCP client test token
- `MCP_CLIENT_REFRESH_TOKEN` - MCP client refresh token
- `MCP_CLIENT_ID` - MCP test client ID
- `MCP_CLIENT_SECRET` - MCP test client secret

### Why So Many Test Tokens?

The gateway includes a comprehensive test suite that tests the full OAuth flow. These test tokens allow the tests to:

- Authenticate as a client
- Verify token generation
- Test token refresh
- Validate API access

But for running the gateway in production, you don't need any of them!

## Common Misconceptions

### "I need GITHUB_PAT to run the gateway"

**No!** The `GITHUB_PAT` is only used by tests to make GitHub API calls. The gateway itself uses the GitHub OAuth App credentials (`GITHUB_CLIENT_ID` and `GITHUB_CLIENT_SECRET`) to authenticate users.

### "I need to run generate-github-token before starting"

**No!** The `just generate-github-token` command generates tokens for testing. The gateway can start without these tokens.

### "All tokens in .env.example are required"

**No!** Most tokens in `.env.example` are for testing. The gateway only needs the 5 core tokens listed above.

## Troubleshooting Minimal Setup

### Gateway won't start

Check that you have all 5 required tokens:
```bash
grep -E "GITHUB_CLIENT_ID|GITHUB_CLIENT_SECRET|GATEWAY_JWT_SECRET|JWT_PRIVATE_KEY_B64|REDIS_PASSWORD" .env
```

### Authentication fails

1. Verify GitHub OAuth App callback URL matches your domain
2. Check `ALLOWED_GITHUB_USERS` includes the test user
3. Ensure DNS is properly configured

### SSL certificate errors

1. Verify ports 80/443 are accessible
2. Check `ACME_EMAIL` is valid
3. Ensure `BASE_DOMAIN` resolves to your server

## Next Steps

Once the gateway is running with minimal configuration:

1. Test user authentication by visiting `https://auth.yourdomain.com`
2. Enable/disable specific MCP services as needed
3. Configure additional security settings
4. Set up monitoring and backups

Remember: You can always add more configuration later. Start minimal and expand as needed!
