# Environment Variables

Complete reference for all environment variables used in the MCP OAuth Gateway.

## Getting Started

1. **Copy the example file**:
   ```bash
   cp .env.example .env
   ```

2. **Edit the `.env` file** with your actual values

3. **Generate required secrets**:
   ```bash
   just generate-jwt-secret    # Generates GATEWAY_JWT_SECRET
   just generate-rsa-keys      # Generates JWT_PRIVATE_KEY_B64
   ```

## Required Variables

### GitHub OAuth Configuration

These variables are required for GitHub OAuth integration:

| Variable | Description | Example |
|----------|-------------|---------|
| `GITHUB_CLIENT_ID` | GitHub OAuth app client ID | `Iv1.a1b2c3d4...` |
| `GITHUB_CLIENT_SECRET` | GitHub OAuth app secret | `abcd1234...` |

**How to obtain**:
1. Go to [GitHub Settings > Developer settings > OAuth Apps](https://github.com/settings/applications/new)
2. Create a new OAuth App with:
   - Homepage URL: `https://your-domain.com`
   - Authorization callback URL: `https://auth.your-domain.com/callback`
3. Copy the Client ID and Client Secret

### JWT Configuration

| Variable | Description | Example | Generate with |
|----------|-------------|---------|---------------|
| `GATEWAY_JWT_SECRET` | JWT signing secret (min 32 chars) | `your_jwt_secret_key_at_least_32_chars` | `just generate-jwt-secret` |
| `JWT_PRIVATE_KEY_B64` | Base64 encoded RSA private key | `LS0tLS1CRUdJTi...` | `just generate-rsa-keys` |
| `JWT_ALGORITHM` | JWT signing algorithm | `RS256` | - |

### Domain Configuration

| Variable | Description | Example |
|----------|-------------|---------|
| `BASE_DOMAIN` | Base domain for all services | `your-domain.com` |
| `ACME_EMAIL` | Email for Let's Encrypt certificates | `admin@your-domain.com` |

### Redis Security

| Variable | Description | Example |
|----------|-------------|---------|
| `REDIS_PASSWORD` | Redis password for auth | `your_redis_password` |

### MCP Protocol

| Variable | Description | Default |
|----------|-------------|---------|
| `MCP_PROTOCOL_VERSION` | MCP protocol version to use | `2025-03-26` |

## Optional Variables

### Access Control

| Variable | Description | Example | Default |
|----------|-------------|---------|---------|
| `ALLOWED_GITHUB_USERS` | Comma-separated list of allowed GitHub usernames. Use `*` to allow any authenticated GitHub user | `user1,user2,user3` or `*` | (empty - all users allowed) |

### Token Lifetimes

| Variable | Description | Default |
|----------|-------------|---------|
| `ACCESS_TOKEN_LIFETIME` | Access token lifetime in seconds | `86400` (24 hours) |
| `REFRESH_TOKEN_LIFETIME` | Refresh token lifetime in seconds | `2592000` (30 days) |
| `SESSION_TIMEOUT` | Session timeout in seconds | `3600` (1 hour) |
| `CLIENT_LIFETIME` | Client registration lifetime in seconds (0 = eternal) | `7776000` (90 days) |

## Generated Variables

These variables are automatically generated by commands and should not be edited manually:

### Gateway OAuth Tokens

Generated by `just generate-github-token`:

| Variable | Description |
|----------|-------------|
| `GITHUB_PAT` | GitHub Personal Access Token |
| `GATEWAY_OAUTH_JWT_TOKEN` | Gateway's own JWT token |
| `GATEWAY_OAUTH_CLIENT_ID` | Dynamically registered client ID |
| `GATEWAY_OAUTH_CLIENT_SECRET` | Dynamically registered client secret |
| `GATEWAY_OAUTH_ACCESS_TOKEN` | Gateway's OAuth access token |
| `GATEWAY_OAUTH_REFRESH_TOKEN` | Gateway's OAuth refresh token |

### MCP Client Tokens

Generated by `just mcp-client-token`:

| Variable | Description |
|----------|-------------|
| `MCP_CLIENT_ACCESS_TOKEN` | Access token for external MCP clients |

## Service Configuration

### MCP Service Enable/Disable Flags

Control which services are deployed:

| Variable | Description | Default |
|----------|-------------|---------|
| `MCP_EVERYTHING_ENABLED` | Enable MCP Everything service | `true` |
| `MCP_FETCH_ENABLED` | Enable MCP Fetch service | `true` |
| `MCP_FETCHS_ENABLED` | Enable MCP Fetchs service | `true` |
| `MCP_FILESYSTEM_ENABLED` | Enable MCP Filesystem service | `true` |
| `MCP_MEMORY_ENABLED` | Enable MCP Memory service | `true` |
| `MCP_PLAYWRIGHT_ENABLED` | Enable MCP Playwright service | `true` |
| `MCP_SEQUENTIALTHINKING_ENABLED` | Enable MCP Sequential Thinking service | `true` |
| `MCP_TIME_ENABLED` | Enable MCP Time service | `true` |
| `MCP_TMUX_ENABLED` | Enable MCP Tmux service | `true` |

### MCP Service Test Configuration

Control which service tests are run:

| Variable | Description | Default |
|----------|-------------|---------|
| `MCP_EVERYTHING_TESTS_ENABLED` | Run tests for MCP Everything | `false` |
| `MCP_FETCH_TESTS_ENABLED` | Run tests for MCP Fetch | `false` |
| `MCP_FETCHS_TESTS_ENABLED` | Run tests for MCP Fetchs | `false` |
| `MCP_FILESYSTEM_TESTS_ENABLED` | Run tests for MCP Filesystem | `false` |
| `MCP_MEMORY_TESTS_ENABLED` | Run tests for MCP Memory | `false` |
| `MCP_PLAYWRIGHT_TESTS_ENABLED` | Run tests for MCP Playwright | `false` |
| `MCP_SEQUENTIALTHINKING_TESTS_ENABLED` | Run tests for MCP Sequential Thinking | `false` |
| `MCP_TIME_TESTS_ENABLED` | Run tests for MCP Time | `false` |
| `MCP_TMUX_TESTS_ENABLED` | Run tests for MCP Tmux | `false` |

### MCP Service URLs

Configure service endpoints (useful for testing):

| Variable | Description | Example |
|----------|-------------|---------|
| `MCP_EVERYTHING_URLS` | MCP Everything endpoints | `https://everything.yourdomain.com/mcp` |
| `MCP_FETCH_URLS` | MCP Fetch endpoints | `https://fetch.yourdomain.com/mcp` |
| `MCP_FETCHS_URLS` | MCP Fetchs endpoints | `https://fetchs.yourdomain.com/mcp` |
| `MCP_FILESYSTEM_URLS` | MCP Filesystem endpoints | `https://filesystem.yourdomain.com/mcp` |
| `MCP_MEMORY_URLS` | MCP Memory endpoints | `https://memory.yourdomain.com/mcp` |
| `MCP_PLAYWRIGHT_URLS` | MCP Playwright endpoints | `https://playwright.yourdomain.com/mcp` |
| `MCP_SEQUENTIALTHINKING_URLS` | MCP Sequential Thinking endpoints | `https://sequentialthinking.yourdomain.com/mcp` |
| `MCP_TIME_URLS` | MCP Time endpoints | `https://time.yourdomain.com/mcp` |
| `MCP_TMUX_URLS` | MCP Tmux endpoints | `https://tmux.yourdomain.com/mcp` |

## Test Configuration

Variables for test suite configuration:

| Variable | Description | Default |
|----------|-------------|---------|
| `TEST_HTTP_TIMEOUT` | HTTP timeout for tests in seconds | `30.0` |
| `TEST_MAX_RETRIES` | Maximum retries for failed requests | `3` |
| `TEST_RETRY_DELAY` | Delay between retries in seconds | `1.0` |
| `TEST_CALLBACK_URL` | OAuth callback URL for tests | `https://localhost:9999/callback` |
| `TEST_CLIENT_NAME` | OAuth client name for tests | `test-client` |
| `TEST_CLIENT_SCOPE` | OAuth scopes for tests | `mcp:read mcp:write` |
| `TEST_REDIRECT_URI` | OAuth redirect URI for tests | `https://localhost:9999/callback` |
| `TEST_INVALID_REDIRECT_URI` | Invalid redirect URI for testing | `https://evil.com/callback` |

## Health Check Configuration

| Variable | Description | Default |
|----------|-------------|---------|
| `HEALTH_CHECK_TIMEOUT` | Health check timeout in seconds | `30` |
| `HEALTH_CHECK_INTERVAL` | Health check interval in seconds | `5` |

## Complete .env Example

Here's a complete example with all required variables:

```bash
# ===== REQUIRED CONFIGURATION =====

# GitHub OAuth (Create app at https://github.com/settings/applications/new)
GITHUB_CLIENT_ID=Iv1.your_actual_client_id
GITHUB_CLIENT_SECRET=your_actual_client_secret

# JWT Configuration (Generate with: just generate-jwt-secret)
GATEWAY_JWT_SECRET=your_jwt_secret_key_at_least_32_chars_long_generated_by_command

# RSA Keys (Generate with: just generate-rsa-keys)
JWT_PRIVATE_KEY_B64=LS0tLS1CRUdJTi...your_base64_encoded_key
JWT_ALGORITHM=RS256

# Domain Configuration
BASE_DOMAIN=your-domain.com
ACME_EMAIL=admin@your-domain.com

# Redis Security
REDIS_PASSWORD=your_secure_redis_password

# MCP Protocol Version
MCP_PROTOCOL_VERSION=2025-03-26

# ===== OPTIONAL CONFIGURATION =====

# Access Control (comma-separated GitHub usernames, or '*' to allow all)
ALLOWED_GITHUB_USERS=johndoe,janedoe,teamlead

# Token Lifetimes
ACCESS_TOKEN_LIFETIME=86400      # 24 hours
REFRESH_TOKEN_LIFETIME=2592000   # 30 days
SESSION_TIMEOUT=3600             # 1 hour
CLIENT_LIFETIME=7776000          # 90 days (or 0 for eternal)

# ===== GENERATED TOKENS (DO NOT EDIT MANUALLY) =====

# Generated by: just generate-github-token
GITHUB_PAT=ghp_xxx...
GATEWAY_OAUTH_JWT_TOKEN=eyJhbGc...
GATEWAY_OAUTH_CLIENT_ID=client_xxx...
GATEWAY_OAUTH_CLIENT_SECRET=secret_xxx...
GATEWAY_OAUTH_ACCESS_TOKEN=xxx...
GATEWAY_OAUTH_REFRESH_TOKEN=refresh_xxx...

# Generated by: just mcp-client-token
MCP_CLIENT_ACCESS_TOKEN=xxx...

# ===== SERVICE CONFIGURATION =====

# Enable/disable services (set to false to disable)
MCP_EVERYTHING_ENABLED=true
MCP_FETCH_ENABLED=true
MCP_FETCHS_ENABLED=true
MCP_FILESYSTEM_ENABLED=true
MCP_MEMORY_ENABLED=true
MCP_PLAYWRIGHT_ENABLED=true
MCP_SEQUENTIALTHINKING_ENABLED=true
MCP_TIME_ENABLED=true
MCP_TMUX_ENABLED=true

# Enable/disable tests (set to true to run tests)
MCP_EVERYTHING_TESTS_ENABLED=false
MCP_FETCH_TESTS_ENABLED=false
MCP_FETCHS_TESTS_ENABLED=false
MCP_FILESYSTEM_TESTS_ENABLED=false
MCP_MEMORY_TESTS_ENABLED=false
MCP_PLAYWRIGHT_TESTS_ENABLED=false
MCP_SEQUENTIALTHINKING_TESTS_ENABLED=false
MCP_TIME_TESTS_ENABLED=false
MCP_TMUX_TESTS_ENABLED=false

# Service URLs (update with your actual domain)
MCP_EVERYTHING_URLS=https://everything.your-domain.com/mcp
MCP_FETCH_URLS=https://fetch.your-domain.com/mcp
MCP_FETCHS_URLS=https://fetchs.your-domain.com/mcp
MCP_FILESYSTEM_URLS=https://filesystem.your-domain.com/mcp
MCP_MEMORY_URLS=https://memory.your-domain.com/mcp
MCP_PLAYWRIGHT_URLS=https://playwright.your-domain.com/mcp
MCP_SEQUENTIALTHINKING_URLS=https://sequentialthinking.your-domain.com/mcp
MCP_TIME_URLS=https://time.your-domain.com/mcp
MCP_TMUX_URLS=https://tmux.your-domain.com/mcp

# ===== TEST CONFIGURATION =====

TEST_HTTP_TIMEOUT=30.0
TEST_MAX_RETRIES=3
TEST_RETRY_DELAY=1.0
TEST_CALLBACK_URL=https://localhost:9999/callback
TEST_CLIENT_NAME=test-client
TEST_CLIENT_SCOPE=mcp:read mcp:write
TEST_REDIRECT_URI=https://localhost:9999/callback
TEST_INVALID_REDIRECT_URI=https://evil.com/callback

# ===== HEALTH CHECK CONFIGURATION =====

HEALTH_CHECK_TIMEOUT=30
HEALTH_CHECK_INTERVAL=5
```

## Setup Steps

1. **Copy `.env.example` to `.env`**:
   ```bash
   cp .env.example .env
   ```

2. **Create GitHub OAuth App**:
   - Go to [GitHub OAuth Apps](https://github.com/settings/applications/new)
   - Set Homepage URL: `https://your-domain.com`
   - Set Callback URL: `https://auth.your-domain.com/callback`
   - Copy Client ID and Secret to `.env`

3. **Generate required secrets**:
   ```bash
   just generate-jwt-secret    # Updates GATEWAY_JWT_SECRET in .env
   just generate-rsa-keys      # Updates JWT_PRIVATE_KEY_B64 in .env
   ```

4. **Configure your domain**:
   - Update `BASE_DOMAIN` with your actual domain
   - Update `ACME_EMAIL` with your email for Let's Encrypt

5. **Set Redis password**:
   - Choose a strong password for `REDIS_PASSWORD`

6. **Configure access control** (optional):
   - Add allowed GitHub usernames to `ALLOWED_GITHUB_USERS`
   - Or set `ALLOWED_GITHUB_USERS=*` to allow any authenticated GitHub user

7. **Generate OAuth tokens**:
   ```bash
   just generate-github-token  # Interactive OAuth flow
   just mcp-client-token       # Generate client token
   ```

## Validation

To validate your configuration:

```bash
# Check if all required variables are set
grep -E "^(GITHUB_CLIENT_ID|GITHUB_CLIENT_SECRET|GATEWAY_JWT_SECRET|BASE_DOMAIN|REDIS_PASSWORD)=" .env

# Validate tokens
just validate-tokens

# Check service health
just check-health
```

## Security Best Practices

1. **Never commit `.env` to version control** - it contains secrets!
2. **Use strong, randomly generated passwords** for all secrets
3. **Rotate tokens regularly** in production environments
4. **Limit `ALLOWED_GITHUB_USERS`** to only trusted users (unless intentionally set to `*`)
5. **Use different values** for development, staging, and production
6. **Monitor token usage** and revoke compromised tokens immediately

## Troubleshooting

### Missing Variables
If services fail to start, check for missing required variables:
```bash
docker-compose logs auth | grep "Required environment variable"
```

### Invalid JWT Secret
If you see JWT validation errors:
```bash
just generate-jwt-secret  # Regenerate the secret
just down && just up      # Restart services
```

### Expired Tokens
Check and regenerate expired tokens:
```bash
just check-token-expiry
just generate-github-token  # If expired
```

### Wrong Protocol Version
If you see protocol version mismatches:
- Check `MCP_PROTOCOL_VERSION` matches your MCP clients
- Default is `2025-03-26` but can be changed as needed