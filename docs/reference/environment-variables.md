# Environment Variables

Complete reference for all environment variables used in the MCP OAuth Gateway.

## Required Variables

### Core System Variables

| Variable | Type | Required | Description | Example |
|----------|------|----------|-------------|---------|
| `BASE_DOMAIN` | String | ✅ | Base domain for all services | `example.com` |
| `GATEWAY_JWT_SECRET` | String | ✅ | JWT signing secret (Base64URL) | `abcd1234...` |

### GitHub OAuth Variables

| Variable | Type | Required | Description | Example |
|----------|------|----------|-------------|---------|
| `GITHUB_CLIENT_ID` | String | ✅ | GitHub OAuth app client ID | `Iv1.a1b2c3d4...` |
| `GITHUB_CLIENT_SECRET` | String | ✅ | GitHub OAuth app secret | `ghp_abc123...` |
| `ALLOWED_GITHUB_USERS` | String | ✅ | Comma-separated list of allowed users | `user1,user2` |

## Optional Variables

### OAuth Gateway Configuration

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `CLIENT_LIFETIME` | Integer | `7776000` | Client registration lifetime (seconds), 0 = eternal |
| `MCP_PROTOCOL_VERSION` | String | `2025-06-18` | MCP protocol version |

### Generated/Runtime Variables

| Variable | Type | Generated By | Description |
|----------|------|--------------|-------------|
| `GATEWAY_OAUTH_ACCESS_TOKEN` | JWT | `just generate-github-token` | Gateway access token |
| `GATEWAY_OAUTH_REFRESH_TOKEN` | String | `just generate-github-token` | Gateway refresh token |
| `MCP_CLIENT_ACCESS_TOKEN` | JWT | `just mcp-client-token` | External client access token |

### Docker Configuration Variables

| Variable | Type | Default | Description |
|----------|------|---------|-------------|
| `COMPOSE_BAKE` | String | `true` | Enable Compose Bake for performance |

## Service-Specific Variables

### Auth Service

#### Required
- `GATEWAY_JWT_SECRET`: JWT signing key
- `GITHUB_CLIENT_ID`: GitHub OAuth client ID
- `GITHUB_CLIENT_SECRET`: GitHub OAuth client secret
- `ALLOWED_GITHUB_USERS`: User access control

#### Optional
- `CLIENT_LIFETIME`: Client registration expiry
- `LOG_LEVEL`: Logging verbosity (default: `INFO`)
- `REDIS_URL`: Redis connection string (default: `redis://redis:6379`)

### MCP Services

#### Common Variables
- `MCP_PROTOCOL_VERSION`: Protocol version
- `PORT`: Service port (default: `3000`)

#### Service-Specific Commands
- **mcp-fetch**: `MCP_COMMAND=python -m mcp_server_fetch`
- **mcp-time**: `MCP_COMMAND=python -m mcp_server_time`
- **mcp-memory**: `MCP_COMMAND=python -m mcp_server_memory`

### Redis Service

#### Connection
- `REDIS_URL`: Connection string (internal: `redis://redis:6379`)
- `REDIS_PASSWORD`: Password (if authentication enabled)

### Traefik Service

#### ACME/Let's Encrypt
- `ACME_EMAIL`: Email for Let's Encrypt certificates
- `TRAEFIK_API_DASHBOARD`: Enable dashboard (default: `true`)

## Variable Generation Commands

### JWT Secret
```bash
just generate-jwt-secret
```
Generates and saves `GATEWAY_JWT_SECRET` to `.env`

### GitHub OAuth Token
```bash
just generate-github-token
```
Generates and saves:
- `GATEWAY_OAUTH_ACCESS_TOKEN`
- `GATEWAY_OAUTH_REFRESH_TOKEN`

### MCP Client Token
```bash
just mcp-client-token
```
Generates and saves `MCP_CLIENT_ACCESS_TOKEN`

### RSA Keys
```bash
just generate-rsa-keys
```
Generates JWT signing keys and saves to volume

## Environment File Structure

### `.env` File Layout
```bash
# Core Configuration
BASE_DOMAIN=your-domain.com
GATEWAY_JWT_SECRET=generated-secret-here

# GitHub OAuth
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret
ALLOWED_GITHUB_USERS=user1,user2,user3

# OAuth Tokens (Generated)
GATEWAY_OAUTH_ACCESS_TOKEN=eyJhbGciOiJSUzI1NiIs...
GATEWAY_OAUTH_REFRESH_TOKEN=refresh_token_here

# MCP Client (Generated)
MCP_CLIENT_ACCESS_TOKEN=client_access_token_here

# Optional Settings
CLIENT_LIFETIME=7776000
MCP_PROTOCOL_VERSION=${MCP_PROTOCOL_VERSION:-2025-06-18}
```

### `.env.example` Template
```bash
# Copy this file to .env and fill in your values

# Core Configuration - REQUIRED
BASE_DOMAIN=your-domain.com
GATEWAY_JWT_SECRET=

# GitHub OAuth - REQUIRED
# Create GitHub OAuth app at https://github.com/settings/applications/new
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=
ALLOWED_GITHUB_USERS=your-github-username

# Generated Tokens - AUTO-FILLED BY COMMANDS
GATEWAY_OAUTH_ACCESS_TOKEN=
GATEWAY_OAUTH_REFRESH_TOKEN=
MCP_CLIENT_ACCESS_TOKEN=

# Optional Configuration
CLIENT_LIFETIME=7776000
MCP_PROTOCOL_VERSION=${MCP_PROTOCOL_VERSION:-2025-06-18}
ACME_EMAIL=admin@your-domain.com
```

## Variable Validation

### Startup Validation

Services validate required variables at startup:

```python
# Example validation in auth service
required_vars = [
    'GATEWAY_JWT_SECRET',
    'GITHUB_CLIENT_ID', 
    'GITHUB_CLIENT_SECRET',
    'ALLOWED_GITHUB_USERS'
]

for var in required_vars:
    if not os.getenv(var):
        raise ValueError(f"Required environment variable {var} not set")
```

### Validation Commands

```bash
just validate-tokens        # Validate OAuth tokens
just check-token-expiry     # Check token expiration
```

## Security Considerations

### Secret Management
- **Never commit** `.env` file to version control
- Use strong, randomly generated secrets
- Rotate secrets regularly
- Use different secrets per environment

### Access Control
- Limit `ALLOWED_GITHUB_USERS` to trusted users only
- Use GitHub organizations for team-based access
- Monitor OAuth token usage

### Token Lifecycle
- Access tokens expire after 30 minutes
- Refresh tokens expire after 1 year
- Client registrations expire after 90 days (unless set to eternal)

## Environment-Specific Configuration

### Development
```bash
# Development settings
BASE_DOMAIN=localhost
CLIENT_LIFETIME=0  # Eternal for dev convenience
LOG_LEVEL=DEBUG
```

### Staging
```bash
# Staging settings
BASE_DOMAIN=staging.your-domain.com
CLIENT_LIFETIME=86400  # 1 day for testing
LOG_LEVEL=INFO
```

### Production
```bash
# Production settings
BASE_DOMAIN=your-domain.com
CLIENT_LIFETIME=7776000  # 90 days
LOG_LEVEL=WARNING
```

## Troubleshooting Variables

### Common Issues

#### Missing Variables
```bash
# Check if all required variables are set
env | grep -E "(GITHUB|GATEWAY|BASE_DOMAIN)"
```

#### Invalid JWT Secret
```bash
# Regenerate JWT secret
just generate-jwt-secret
```

#### Expired Tokens
```bash
# Check token status
just check-token-expiry

# Regenerate if needed
just generate-github-token
```

### Debug Environment
```bash
# Show all environment variables in auth container
just exec-auth env | sort

# Check specific variable
just exec-auth echo $GATEWAY_JWT_SECRET
```

## Variable Dependencies

### Dependency Chain
1. `BASE_DOMAIN` → Required for all service hostnames
2. `GITHUB_CLIENT_ID/SECRET` → Required for OAuth flows
3. `GATEWAY_JWT_SECRET` → Required for token signing
4. `ALLOWED_GITHUB_USERS` → Required for access control

### Service Dependencies
- **Auth Service**: Needs all core variables
- **MCP Services**: Need protocol version and auth configuration
- **Traefik**: Needs domain configuration
- **Redis**: Uses default configuration

## Best Practices

### Variable Naming
- Use `UPPER_CASE` for environment variables
- Use descriptive prefixes (`GITHUB_`, `GATEWAY_`)
- Separate words with underscores

### Documentation
- Document all custom variables
- Provide examples in `.env.example`
- Include validation rules

### Security
- Use secrets management in production
- Audit variable access
- Monitor for credential exposure
- Implement proper rotation

[Environment variables reference - complete list with descriptions and usage]